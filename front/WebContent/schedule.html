<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link href="./css/main.css" rel="stylesheet" />
  <link rel="shortcut icon" href="img/icons/icon-48x48.png" />
  <!-- <link href="css/app.css" rel="stylesheet" /> -->
  <link href="css/schedule.css" rel="stylesheet" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="js/main.js"></script>
  <script src="js/locales-all.min.js"></script>
  <script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.js"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
  <script>
    //calendar 전역번수로 선언 
    var calendar = null;

    //스케쥴의 상세내역을 담고 있는 skdObj를 전역변수로 선언
    var skdInputObj;


    //html 로드 후 javascript 로드 
    $(document).ready(function () {
      //calendar id를 가진div 객체를 변수에 담기
      var calendarEl = document.getElementById("calendar");
      //풀 캘린더를 활성화
      calendar = new FullCalendar.Calendar(calendarEl, {

        initialView: 'dayGridMonth', //1~31 달력 
        locale: 'ko',
        editable: true, // 일정 수정 가능 여부
        eventLimit: true, /*달력상에 셀 크기보다 많은 이벤트가 등록되어 있는 경우 more로 표기*/
        dayMaxEventRows: true,
        navLinks: true,
        selectable: true,
        // select: function (arg) {	// 날짜셀 클릭시(아래는 일정 추가) 
        //   createModal("skdInput");
        //   if (title) {
        //     calendar.addEvent({
        //       title: title,
        //       start: arg.start,
        //       end: arg.end,
        //       allDay: arg.allDay
        //     })
        //   }
        //   calendar.unselect();
        // }
        // , unselect: function (arg) { },
        // eventLimit: true,/*달력상에 셀 크기보다 많은 이벤트가 등록되어 있는 경우 more로 표기*/
        // // navLinkWeekClick: function (weekStart, jsEvent) {
        // //   console.log('week start', weekStart.toISOString());
        // //   console.log('coords', jsEvent.pageX, jsEvent.pageY);
        // // },



        customButtons: {
          addeventButton: {
            text: '일정 추가',
            id: 'modalInputBtn',
            click: function () {
              //modal 띄우기
              const modal = document.getElementById("skdInput");
              const closeBtn = document.querySelector("button.cancel");
              modal.classList.remove("hidden");

              $(closeBtn).on("click", function () {
                modal.classList.add("hidden");
              });

              //저장버튼 클릭이벤트

              $("button.saveBtn").on("click", function () {

                var selectOption = document.getElementById("skdType");
                var skdInputType = selectOption.options[selectOption.selectedIndex]; //일정종류

                var skdInputTitle = $("#input_title"); //제목
                var skdInputContent = $("#input_content"); //내용
                var skdInputStartDate = $("#start_date"); //시작날짜
                var skdInputStartTime = $("#start_time");//시작시간
                var skdInputEndDate = $("#end_date");//종료날짜
                var skdInputEndTime = $("#end_time");//종료시간
                var skdInputShare = $('input[name="radio-3"]:checked');

                //시간 미입력
                // if (skdInputStartTime.val() == "" || skdInputEndTime.val() == "") {
                //   alert("시간을 입력하세요.");
                // }else 
                if(new Date(skdInputEndDate.val()) - new Date(skdInputStartDate.val()) < 0) {
                  alert("종료일이 시작일보다 먼저입니다.");
                } else {    
                  if (skdInputShare.val() == 'p') {
                    calendar.addEvent({
                      title: skdInputTitle.val(),
                      content: skdInputContent.val(),
                      start: skdInputStartDate.val() + " "+skdInputStartTime.val(),
                      end: skdInputEndDate.val() + " "+skdInputEndTime.val(),
                      allDay: false,
                      backgroundColor: '#ffc107',
                      extendedProps: {
                        calendarType: skdInputType.value,
                        teamOrPersonal: skdInputShare.val()
                      }
                      
                    })
                    $('div.wrapper>nav.sidebar>div>div.simplebar-wrapper>div.simplebar-mask>div.simplebar-offset>div>div>ul>li>a[href="mypage.html"]').trigger('click');
                  
                  } else {
                    calendar.addEvent({
                      title: skdInputTitle.val(),
                      content: skdInputContent.val(),
                      start: skdInputStartDate.val() + " "+skdInputStartTime.val(),
                      end: skdInputEndDate.val() + " "+skdInputEndTime.val(),
                      allDay: false,
                      backgroundColor: '#28a745',
                      extendedProps: {
                        calendarType: skdInputType.value,
                        teamOrPersonal: skdInputShare.val()
                      }


                    })
                    $('#sidebar > div > div.simplebar-wrapper > div.simplebar-mask > div > div > div > ul > li.sidebar-item.active > a[href="schedule.html"]').trigger('click');
                  }
                
                }
              
              //데이터 테스트 
                // skdInputObj = {
                //   title: skdInputTitle.val(),
               
                //       title: skdInputTitle.val(),
                //       content: skdInputContent.val(),
                //       start: skdInputStartDate.val() + " "+skdInputStartTime.val(),
                //       end: skdInputEndDate.val() + " "+skdInputEndTime.val(),
                //       allDay: false,
                //       backgroundColor: '#28a745',
                //       extendedProps: {
                //         calendarType: skdInputType.value,
                //         teamOrPersonal: skdInputShare.val()
                //       }

                // }
                // //todo : 입력 해결 
                // // $('#calendar').fullCalendar('renderEvent', skdInputObj, true);
                // console.log(skdInputObj);
           
              });
            }
          },
          teamSchedule: {
            text: '공유 캘린더',
            class: 'teamSchedule'
          },
          personalSchedule: {
            text: '내 캘린더',
            class: 'personalSchedule'
          },
          weekSchedule: {
            text: '주간',
            class: 'weekSchedule'
          },
        },
        //left, center, right 구조 바꾸도록 함 
        headerToolbar: {
          left: 'addeventButton teamSchedule personalSchedule',
          center: 'title',
          right: 'dayGridWeek,dayGridMonth today prev,next'

        },
        //하루 스케쥴 추가, ajax로 작업하기 
        events: [
          { //개인캘린더
            title: '회의',
            start: '2021-07-01 12:30',
            end: '2021-07-01 3:30',
            backgroundColor: '#28a745'

          },

          {
            //개인캘린더
            title: '업무',
            start: '2021-07-01 11:30',
            end: '2021-07-01 3:30',
            backgroundColor: '#ffc107'
          },

          {
            title: '부산출장',
            start: '2021-07-05 12:30',
            end: '2021-07-07 13:30',
            backgroundColor: '#ffc107',
            borderColor: 'white'

          },
        ],

        //extendedProp 적용
        eventDidMount: function (info) {

          // {calendarType: 캘린더타입, teamOrPersonal: 팀or개인일정}
        },

        //일정 클릭했을 때 
        eventClick: function (info) {

          createModal("skdDetail");

        }


      });

      //eventSources : ajax로 기등록된 일정 불러오기 
      //eventAdd: 일정 추가 저장
      //eventChange : 일정 변경 후 저장
      //eventRemove : 일정 삭제 

      //캘린더 이벤트 코드는 여기까지 

      //시작 날짜를 현재 날짜로
      document.getElementById('start_date').value = new Date().toISOString().substring(0, 10);
      //종료 날짜를 현재 날짜로
      document.getElementById('end_date').value = new Date().toISOString().substring(0, 10);

      //시작 시간을 현재 시간으로 
      document.getElementById('start_time').value = new Date(new Date()).toTimeString();
      //종료 시간을 현재 시간으로 
      document.getElementById('end_time').value =  new Date(new Date()).toTimeString();

      // //기간으로 검색하기, 제목내용으로 검색하기 창 설정
      var skdSearchObj = document.getElementById("skdSearch"); //검색입력창

      var categoryObj = document.querySelector("div.dropdown-menu");

      function categoryHandler(e) {
        if (e.target.id == "skdCategoryPeriod") {
          createModal("skdSearchPeriod");
        } else if (e.target.id == "skdCategoryTitle") {
          createModal("skdSearchTitle");
        } else if (e.target.id == "skdCategoryAll") {
          createModal("skdSearchAll");
        }

      }

      function init() {
        categoryObj.addEventListener("click", categoryHandler);
      }

      init();


      //모든 코드를 실행 후 캘린더를 렌더링
      calendar.render();
    });


    //전체 저장 함수, 나한테 전체 저장은 필요 없고 형식만 가져오면 됨
    // function allSave(){
    //   var allEvent = calendar.getEvents();
    //  // console.log(allEvent);//테스트 

    //  var events =new Array();
    //   for(var i=0; i<allEvent.length; i++){

    //     var obj = new Object(); // 아래 데이터를 담을 객체 만들기 
    //     obj.title = allEvent[i]._def.title;
    //     obj.allday = allEvent[i]._def.allday;
    //     obj.start = allEvent[i]._instance.range.start;
    //     obj.end = allEvent[i].instsance.range.end; //obj의 변수에 넣기

    //      //모든 이벤트가 없어질 때까지,타이틀 갖고오기 테스트vlfdy
    //      events.push(obj);// 배열에 obj넣기 
    //   }

    //      // events를 서버에 전송할 때 문자열 형태로넘겨야 해서 String으로 변환할 필ㄹ요가 있음 
    // var jsondata = JSON.Stringify(events);
    // console.log(jsondata); //jsondata 콘솔테스트

    // savedata(jsondata); //savedata 메서드에 jsondata 넣기 
    // }

    // //ajax넣기 
    // function savedata(jsondata){
    //   $.ajax
    // } 


    //데이터베이스에 저장할 데이터추출하기 
    //title, start, end 등 라이브러리에서 갖고 오는 


  </script>

  
</head>


<body id="skdBody">
  <div class="wrapper">
    <div class="main">
      <main class="content">
        <div class="container-fluid p-0">
          <div>
            <div class="type-calendar btn-group btn-group-sm">
              <button
                type="button"
                class="btn fc-button-primary"
                id = "teamSkd"
              >
                공유 캘린더
              </button> &nbsp; &nbsp;
              <button
                type="button"
                class="btn fc-button-primary"
                id = "personalSkd"
              >
                내 캘린더
              </button>
            </div>
          </div>


  <!-- 일정검색란 -->
      <div class="container-fluid p-0">
        <form method="get" action="#" class="d-none d-sm-inline-block col-md-3">
      <div class="input-group input-group-navbar">
        <div>
          <div class="btn-group btn-group-sm">
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">
              검색
            </button>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="#" id="skdCategoryAll">전체 검색</a>
              <!--todo and option 
              1. input 창에 검색 시 기본적으로 전체 검색될 것
              2. 기간으로 검색 시 modal창 띄울 것
              3. 제목, 내용으로 검색 시 modal  창 띄울 것  -->
              <a class="dropdown-item" href="#" id="skdCategoryPeriod">기간으로 검색</a>
              <a class="dropdown-item" href="#" id="skdCategoryTitle">제목, 내용으로 검색</a>

            </div>
          </div>
        </div>
        <input type="text" class="form-control" placeholder="Search…" aria-label="Search" style="width: 25%"
          id="skdSearch" />
      </div>
    </form>

    <div id="calendar" class=""></div>
  </div>

    </main>
  </div>
  </div> 


  <!-- 스케쥴 입력모달창 -->
  <div class="modal hidden" id="skdInput">
    <!-- advice : 화면 바깥을 클릭해도 꺼질 수 있도록 modal overlay를 설정했습니다. 관련 함수는 modalOutput.html에 존재합니다. -->
    <div class="modal_overlay"></div>
    <!-- advice: 내용은 여기에 담깁니다 -->
    <div class="modal_content">
      <div class="card">
        <div class="card-header" style="padding: 0 20px;">
          <h4>일정 추가</h4>

        </div>
        <form class="skdInsertClass">

        <div class="card-body">
          
          <div class="mb-3 row">
            <label class="col-form-label col-sm-2 text-sm-right">종류</label>
            <div class="col-sm-10">
              <select name="skdType" id="skdType" style="width:40%; border: 1px solid #ced4da;">
                <option value="업무">업무</option>
                <option value="외근">외근</option>
                <option value="출장">출장</option>
                <option value="회의">회의</option>
                <option value="휴가">휴가</option>
              </select>
            </div>
          </div>
          <div class="mb-3 row">
            <label class="col-form-label col-sm-2 text-sm-right">제목</label>
            <div class="col-sm-10">
              <input type="text" id="input_title" class="form-control">
            </div>
          </div>
          <!-- 시작 -->
          <div class="mb-3 row">
            <label class="col-form-label col-sm-2 text-sm-right">시작</label>
            <div class="col-sm-10">
              <!-- 날짜 -->
              <input type="date" id="start_date" style="width: 50%; border: 1px solid #ced4da" />

              <!-- 시작시간 -->
              <input type="time" id="start_time" style="width:40%; border: 1px solid #ced4da;">

            </div>
          </div>
          <!-- 종료 -->
          <div class="mb-3 row">
            <label class="col-form-label col-sm-2 text-sm-right">종료</label>

            <!-- 종료날짜 -->
            <div class="col-sm-10">
              <input type="date" id="end_date" style="width: 50%; border: 1px solid #ced4da;">

              <!-- 종료시간 -->

              <input type="time" id="end_time" style="width:40%; border: 1px solid #ced4da;">

            </div>
          </div>
          <!-- 내용 -->
          <div class="mb-3 row">
            <label class="col-form-label col-sm-2 text-sm-right">내용</label>
            <div class="col-sm-10">
              <!-- 텍스트박스 -->
              <textarea class="form-control" id="input_content" rows="10"></textarea>
            </div>
          </div>
          <!-- 팀일정, 개인일정 설정 -->
          <fieldset class="mb-3">
            <div class="row">
              <label class="col-form-label col-sm-2 text-sm-right pt-sm-0">캘린더</label>
              <div class="col-sm-10">
                <label class="form-check">
                  <!-- 개인일정 -->
                  <input name="radio-3" type="radio" class="form-check-input" value="p" checked="">
                  <span class="form-check-label">개인일정</span>
                </label>
                <!-- 팀일정 -->
                <label class="form-check">
                  <input name="radio-3" type="radio" class="form-check-input" value="t">
                  <span class="form-check-label">팀일정</span>
                </label>

              </div>
            </div>
          </fieldset>

          <!-- 저장 , 취소박스-->
          <div class="mb-3 row">
            <div style="text-align: center; margin: 10px 0;">
              <button type="submit" class="btn btn-primary saveBtn"> 저장 </button>
              <button class="btn btn-secondary cancel" type="button"> 취소
              </button>
            </div>
          </div>

          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- 스케쥴 상세내역 -->
  <div class="modal hidden" id="skdDetail">
    <div class="modal_overlay"></div>

    <div class="modal_content">

      <div class="card-header">
        <button class="xBox" style="float: right; border-style: 1px solid #6c757d; 
                    border-radius: 7px;
                    background-color: #6c757d; 
                    color: white; cursor: pointer; ">X</button>
        <h4>일정 상세 내역</h4>

      </div>
      <!--card-header div-->
      <table class="table">
        <tbody>
          <tr id="skdDetailShare" class="skdDetailShare">
            <td style="width:30%;"><Strong>캘린더</Strong></td>
            <td style="width:70%" class="skdDetailInputData"></td>
          </tr>


          <tr id="skdDetailTitle">
            <td> <Strong>제목</Strong></td>
            <td class="skdDetailInputData">
            </td>
          </tr> 

          <tr id="skdDetailType">
            <td><Strong>종류</Strong></td>
            <td class="skdDetailInputData"></td>
          </tr>

          <tr id="skdDetailStartTime">
            <td><Strong>시작 시간</Strong></td>
            <td class="skdDetailInputData"> </td>

          </tr>

          <tr id="skdDetailEndTime">
            <td><Strong>종료 시간</Strong></td>
            <td class="skdDetailInputData"></td>

          </tr>

          <tr id="skdDetailContent">
            <td><Strong>내용</Strong></td>
            <td class="skdDetailInputData">
            </td>

          </tr>


        </tbody>
      </table>

      <!-- 수정 / 삭제  -->
      <div class="mb-3 row ">
        <div style="text-align: center; margin: 10px 0;">
          <button class="btn btn-primary "> 수정 </button>
          <button class="btn btn-secondary deleteBtn"> 삭제 </button>
        </div>
        <!--수정삭제 div-->
      </div>
      <!--수정삭제 부모div-->


    </div>
    <!--modal-content div-->
  </div>
  <!--modal div-->

  <!--스케쥴 기간검색-->
  <div class="modal hidden" id="skdSearchPeriod">
    <div class="modal_overlay"></div>

    <div class="modal_content">



      <div class="card-header">
        <button class="xBox" style="float: right; border-style: 1px solid #6c757d; 
                    border-radius: 7px;
                    background-color: #6c757d; 
                    color: white; cursor: pointer; ">X</button>
        <h4>일정 검색</h4>

      </div>
      <form action="">
        <table class="table">
          <thead>
            <tr>
              <th style="width:30%;">캘린더</th>
              <th style="width:70%">
                <select name="캘린더">
                  <option value="">전체캘린더</option>
                  <option value="t">공유캘린더</option>
                  <option value="p">내 캘린더</option>
                </select>

              </th>

            </tr>
          </thead>
          <tbody>

            <tr>
              <td>시작일</td>
              <td><input type="date"></td>
            </tr>

            <tr>
              <td>종료일</td>
              <td><input type="date"> </td>

            </tr>

          </tbody>
        </table>
      </form>
      <!-- 검색, 취소 -->
      <div class="mb-3 row">
        <div style="text-align: center; margin: 10px 0;">
          <button class="btn btn-primary " type="submit"> 검색 </button>


          <button class="btn btn-secondary cancel" type="button"> 취소 </button>
        </div>
      </div>




    </div>
    <!--modal-content div-->

  </div>
  <!--modal-->

  <!--스케쥴 제목내용검색-->
  <div class="modal hidden" id="skdSearchTitle">
    <div class="modal_overlay"></div>

    <div class="modal_content">



      <div class="card-header">
        <button class="xBox" style="float: right; border-style: 1px solid #6c757d; 
                  border-radius: 7px;
                  background-color: #6c757d; 
                  color: white; cursor: pointer; ">X</button>
        <h4>제목, 내용 검색</h4>

      </div>
      <form action="">
        <table class="table">
          <thead>
            <tr>
              <th style="width:30%;">캘린더</th>
              <th style="width:70%;">
                <select name="캘린더">
                  <option value="">전체캘린더</option>
                  <option value="p">공유캘린더</option>
                  <option value="t">내 캘린더</option>
                </select>

              </th>

            </tr>
          </thead>
          <tbody>

            <tr>
              <td>제목</td>
              <td><input type="text"></td>
            </tr>

            <tr>
              <td>내용</td>
              <td><input type="text"> </td>

            </tr>

          </tbody>
        </table>
      </form>
      <!-- 수정 / 삭제  -->
      <div class="mb-3 row">
        <div style="text-align: center; margin: 10px 0;">
          <button class="btn btn-primary" type="submit"> 검색 </button>
          <button class="btn btn-secondary cancel" type="button"> 취소 </button>
        </div>
      </div>
    </div>


  </div>
  </div>
  </div>

  <!--스케쥴 제목내용기간 전체 검색-->
  <div class="modal hidden" id="skdSearchAll">
    <div class="modal_overlay"></div>

    <div class="modal_content">



      <div class="card-header">
        <button class="xBox" style="float: right; border-style: 1px solid #6c757d; 
                  border-radius: 7px;
                  background-color: #6c757d; 
                  color: white; cursor: pointer; ">X</button>
        <h4>일정 검색</h4>

      </div>
      <form action="">
        <table class="table">
          <thead>
            <tr>
              <th style="width:30%;">캘린더</th>
              <th style="width:70%;">
                <select name="캘린더">
                  <option value="">전체캘린더</option>
                  <option value="t">공유캘린더</option>
                  <option value="p">내 캘린더</option>
                </select>

              </th>

            </tr>
          </thead>
          <tbody>

            <tr>
              <td>제목</td>
              <td><input type="text"></td>
            </tr>

            <tr>
              <td>내용</td>
              <td><input type="text"> </td>

            </tr>

            <tr>
              <td>시작일</td>
              <td><input type="date"></td>
            </tr>

            <tr>
              <td>종료일</td>
              <td><input type="date"> </td>

            </tr>

          </tbody>
        </table>
      </form>
      <!-- 수정 / 삭제  -->
      <div class="mb-3 row">
        <div style="text-align: center; margin: 10px 0;">
          <button class="btn btn-primary" type="submit"> 검색 </button>


          <button type="button" type="button" class="btn btn-secondary cancel"> 취소 </button>
        </div>
      </div>
    </div>


  </div>
  </div>
  </div>

  <script src="js/app.js"></script>
  <script src="js/schedule.js"></script>
</body>

</html>